# Welcome Message Module - Integration Guide

## üìã –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `welcome_message` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Nexy AI Assistant. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ä–µ—á–∏ —á–µ—Ä–µ–∑ Azure TTS.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **`WelcomePlayer`** - –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–µ–µ—Ä –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
2. **`WelcomeAudioGenerator`** - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∞—É–¥–∏–æ (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π)
3. **`WelcomeConfig`** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è
4. **`WelcomeMessageIntegration`** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å EventBus

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
modules/welcome_message/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ welcome_player.py          # –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–µ–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ audio_generator.py         # gRPC –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ types.py                   # –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ welcome_config.py          # –ó–∞–≥—Ä—É–∑—á–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ test_welcome_player.py
    ‚îî‚îÄ‚îÄ test_audio_generator.py
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from modules.welcome_message import WelcomePlayer, WelcomeConfig

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
config = WelcomeConfig(
    enabled=True,
    text="Hi! Nexy is here. How can I help you?",
    use_server=True,
)

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–µ–µ—Ä–∞
player = WelcomePlayer(config)

# –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
result = await player.play_welcome()
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å EventBus

```python
from integration.integrations.welcome_message_integration import WelcomeMessageIntegration

# –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
integration = WelcomeMessageIntegration(
    event_bus=event_bus,
    state_manager=state_manager,
    error_handler=error_handler
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫
await integration.initialize()
await integration.start()
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
# client/config/unified_config.yaml
welcome_message:
  enabled: true
  text: "Hi! Nexy is here. How can I help you?"
  delay_sec: 1.0
  volume: 0.8
  voice: "en-US-JennyNeural"
  sample_rate: 48000
  channels: 1
  bit_depth: 16
  use_server: true
  server_timeout_sec: 30.0
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `enabled` | bool | true | –í–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è |
| `text` | str | "Hi! Nexy is here. How can I help you?" | –¢–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è |
| `use_server` | bool | true | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é |
| `server_timeout_sec` | float | 30.0 | –¢–∞–π–º–∞—É—Ç RPC `GenerateWelcomeAudio` |
| `delay_sec` | float | 1.0 | –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º |
| `volume` | float | 0.8 | –ì—Ä–æ–º–∫–æ—Å—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è |
| `voice` | str | "en-US-JennyNeural" | –ì–æ–ª–æ—Å –¥–ª—è TTS |
| `sample_rate` | int | 48000 | –ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ |
| `channels` | int | 1 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤ |
| `bit_depth` | int | 16 | –†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å |

## üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Azure TTS) —á–µ—Ä–µ–∑ RPC `GenerateWelcomeAudio`. –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ fallback'–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Sample Rate**: 48000 Hz
- **Channels**: 1 (mono)
- **Bit Depth**: 16-bit
- **Format**: PCM s16le

## üîÑ EventBus —Å–æ–±—ã—Ç–∏—è

### –í—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è

| –°–æ–±—ã—Ç–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---------|----------|-----------|
| `app.startup` | –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | MEDIUM |

### –ò—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è

| –°–æ–±—ã—Ç–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–∞–Ω–Ω—ã–µ |
|---------|----------|--------|
| `welcome.started` | –ù–∞—á–∞–ª–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è | `{"text": str, "method": str}` |
| `welcome.completed` | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è | `{"success": bool, "method": str, "duration_sec": float}` |
| `welcome.failed` | –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è | `{"error": str, "text": str}` |
| `playback.signal` | –ó–∞–ø—Ä–æ—Å –Ω–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ | `{"pcm": bytes, "sample_rate": int, "channels": int}` |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã –º–æ–¥—É–ª—è
pytest client/modules/welcome_message/tests/

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest client/modules/welcome_message/tests/test_welcome_player.py

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest client/modules/welcome_message/tests/ --cov=modules.welcome_message
```

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–µ–µ—Ä–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
3. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ** - —É—Å–ø–µ—à–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
4. **Fallback** - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ TTS
5. **–û—à–∏–±–∫–∏** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞ —Å EventBus

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≥–æ–ª–æ—Å–∞

1. –û–±–Ω–æ–≤–∏—Ç—å `WelcomeConfig.voice`
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤ `WelcomeAudioGenerator`
3. –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
4. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –∞—É–¥–∏–æ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞

1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `text` —Å –Ω–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º –Ω–∞ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `voice` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≥–æ–ª–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "ru-RU-DmitryNeural")
3. –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
4. –°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ –Ω–∞ –Ω–æ–≤–æ–º —è–∑—ã–∫–µ

### –û—Ç–ª–∞–¥–∫–∞

```python
import logging
logging.getLogger('modules.welcome_message').setLevel(logging.DEBUG)
```

## üö´ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- ‚úÖ –¢–æ–Ω–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –º–æ–¥—É–ª–µ–π
- ‚úÖ EventBus –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - –≤—Å–µ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ YAML

### –ó–∞–ø—Ä–µ—Ç—ã

- ‚ùå –ù–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª SpeechPlaybackIntegration
- ‚ùå –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚ùå –ù–µ –Ω–∞—Ä—É—à–∞—Ç—å EventBus –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –º–æ–¥—É–ª—è–º–∏ –Ω–∞–ø—Ä—è–º—É—é

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞

- **gRPC –≤—ã–∑–æ–≤**: 300-800ms (Azure TTS)
- **Network retry**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ `GrpcClient`

### –ü–∞–º—è—Ç—å

- **–ü–∞–º—è—Ç—å –±—É—Ñ–µ—Ä–∞**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è (~200KB –Ω–∞ 2-3 —Å–µ–∫—É–Ω–¥—ã PCM)

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```
üéµ [WELCOME_PLAYER] –ù–∞—á–∏–Ω–∞—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
‚úÖ [WELCOME_PLAYER] –°–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
üéµ [WELCOME_INTEGRATION] –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ: server, 2.5s
```

### –ú–µ—Ç—Ä–∏–∫–∏

- –í—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- –ú–µ—Ç–æ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (`server`)
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- –û—à–∏–±–∫–∏ –∏ –∏—Ö —Ç–∏–ø—ã

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ê—É–¥–∏–æ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å gRPC —Å–µ—Ä–≤–µ—Ä–∞
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `GrpcClient` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è (–ª–æ–≥–∏ `modules.grpc_client`)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `GenerateWelcomeAudio` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∞–Ω–∫–∏ (—Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –ª–æ–≥–∏)

2. **–í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `server_timeout_sec`
   - –£–±–µ–¥–∏—Ç—å—Å—è –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Azure TTS
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ –∞—É–¥–∏–æ

### –û—Ç–ª–∞–¥–∫–∞

```python
# –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
logging.getLogger('modules.welcome_message').setLevel(logging.DEBUG)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–µ–µ—Ä–∞
print(player.get_status())

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
print(config.__dict__)
```
