# ðŸ§­ Nexy Server â€” ÐžÐ±Ð·Ð¾Ñ€ ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹

Ð­Ñ‚Ð¾Ñ‚ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ Ð¾Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÑ‚ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñƒ, ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¸ Ð»Ð¾Ð³Ð¸ÐºÑƒ ÑÐµÑ€Ð²ÐµÑ€Ð½Ð¾Ð¹ Ñ‡Ð°ÑÑ‚Ð¸ Nexy: Ñ€Ð¾Ð»Ð¸ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð², Ð¿Ð¾Ñ‚Ð¾Ðº Ð´Ð°Ð½Ð½Ñ‹Ñ…, ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚Ñ‹ gRPC, Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ñ Ð¿Ð°Ð¼ÑÑ‚ÑŒÑŽ/Ð‘Ð”, Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¸ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°.

â€” ÐÑƒÐ´Ð¸Ñ‚ ÐºÐ¾Ð´Ð°: server/main.py, grpc_server.py, text_processor.py, audio_generator.py, database/*, streaming.proto, update_server.py

---

## 1) ÐšÐ°Ñ€Ñ‚Ð¸Ð½Ð° Ð² Ñ†ÐµÐ»Ð¾Ð¼

Ð¡ÐµÑ€Ð²ÐµÑ€ â€” Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¹ gRPC ÑÐµÑ€Ð²Ð¸Ñ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¾Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°:
- ÐŸÑ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð¸ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾) ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚/Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐºÑ€Ð°Ð½Ð°
- Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð½Ñ‹Ðµ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ Ñ‡Ð°Ð½ÐºÐ¸ Ð¸ ÑÐ¸Ð½Ñ‚ÐµÐ·Ð¸Ñ€ÑƒÐµÑ‚ Ð°ÑƒÐ´Ð¸Ð¾ (TTS)
- ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ðµ ÑÐµÑÑÐ¸Ð¹ (interrupt)
- Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ðµ HTTP endpoints Ð´Ð»Ñ health/status
- ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ Ð¿Ð¾Ð´Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Update Server (Sparkle/AppCast)

Ð“Ð»Ð°Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹:
- grpc_server.py â€” Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ gRPC ÑÐµÑ€Ð²Ð¸ÑÐ° (StreamingServicer) Ð¸ Â«serveÂ»
- text_processor.py â€” Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐºÑÑ‚Ð°: Gemini Live API (Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹) / LangChain (fallback) / ÑƒÐ¿Ñ€Ð¾Ñ‰Ñ‘Ð½Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚
- audio_generator.py â€” ÑÐ¸Ð½Ñ‚ÐµÐ· Ñ€ÐµÑ‡Ð¸: Azure Cognitive Services (Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹) / Edge TTS (fallback) / Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¸Ð½ÑƒÑ
- database/* â€” Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð‘Ð”, Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÑÐµÑÑÐ¸Ð¹ Ð¸ ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ð¾Ð²
- streaming.proto â€” ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚ gRPC
- main.py â€” Ñ‚Ð¾Ñ‡ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° HTTP + gRPC (+ Update Server)

---

## 2) ÐšÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚ gRPC (streaming.proto)

Ð¡ÐµÑ€Ð²Ð¸Ñ: `StreamingService`
- `rpc StreamAudio(StreamRequest) returns (stream StreamResponse);` â€” ÑÐµÑ€Ð²ÐµÑ€Ð½Ñ‹Ð¹ ÑÑ‚Ñ€Ð¸Ð¼Ð¸Ð½Ð³
- `rpc InterruptSession(InterruptRequest) returns (InterruptResponse);` â€” Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… ÑÐµÑÑÐ¸Ð¹

Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ:
- `StreamRequest { string prompt; optional string screenshot; optional int32 screen_width; optional int32 screen_height; string hardware_id; optional string session_id; }`
- `StreamResponse { oneof content { string text_chunk; AudioChunk audio_chunk; string end_message; string error_message; } }`
- `AudioChunk { bytes audio_data; string dtype; repeated int32 shape; }`  â€” dtype: Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ `int16`; shape: `[N]`

Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð¸Ñ Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð¼:
- ÐÑƒÐ´Ð¸Ð¾ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚: 48 kHz, mono, int16 (PCM s16le). Ð•ÑÐ»Ð¸ Ð´Ð²Ð¸Ð¶Ð¾Ðº TTS Ð²Ñ‹Ð´Ð°Ñ‘Ñ‚ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚, ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ.
- ÐžÑˆÐ¸Ð±ÐºÐ¸/Ð¾Ñ‚Ð¼ÐµÐ½Ð°: Ð¿Ñ€Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¾Ð¼ Ð¾Ñ‚Ð¼ÐµÐ½Ðµ ÑÑ‚Ñ€Ð¸Ð¼Ð° (context cancelled) Ð½Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ `end_message`; Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð¼ÐµÐ½Ñƒ Ð¸ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐ°Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº.

Ð Ð°Ð·Ð¼ÐµÑ€Ñ‹ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹: ÑÐµÑ€Ð²ÐµÑ€ ÑÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð½Ð° Ð¿Ñ€Ð¸ÐµÐ¼/Ð¾Ñ‚Ð´Ð°Ñ‡Ñƒ Ð´Ð¾ 50MB.

---

## 3) ÐŸÐ¾Ñ‚Ð¾Ðº Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ (StreamAudio)

1) ÐŸÑ€Ð¸Ñ‘Ð¼ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°: prompt, hardware_id, screenshot (+Ñ€Ð°Ð·Ð¼ÐµÑ€Ñ‹ ÑÐºÑ€Ð°Ð½Ð°)
2) Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐµÑÑÐ¸Ð¸: ÑƒÑ‡Ñ‘Ñ‚ Ð² `active_sessions`, Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ `session_id` Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸
3) Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐºÑÑ‚Ð° (TextProcessor): Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¹ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ñ… Ñ‡Ð°Ð½ÐºÐ¾Ð²
4) Ð”Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ `text_chunk` â€” ÑÐ¸Ð½Ñ‚ÐµÐ· Ð°ÑƒÐ´Ð¸Ð¾ (AudioGenerator) â†’ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ° `StreamResponse.audio_chunk`
5) Ð¤Ð¸Ð½Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ: Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ° `end_message` Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ ÑÑ‚Ñ€Ð¸Ð¼Ð°; ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ð° Ð² Ð‘Ð” (ÐµÑÐ»Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½)

ÐŸÑ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ð°:
- ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ ÑÑ‚Ñ€Ð¸Ð¼ Ð´Ð²ÑƒÐ¼Ñ Ð¿ÑƒÑ‚ÑÐ¼Ð¸:
  1) ÐžÑ‚Ð¼ÐµÐ½Ð° ÐºÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° RPC (preferred Ð´Ð»Ñ Â«bargeâ€‘inÂ»). Ð¡ÐµÑ€Ð²ÐµÑ€ Ð¾Ð±ÑÐ·Ð°Ð½ Ñ‡Ð°ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ `context.cancelled()`/`context.is_active()` Ð¸ Ð½ÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾ Ð¿Ñ€ÐµÐºÑ€Ð°Ñ‰Ð°Ñ‚ÑŒ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸ÑŽ Ñ‚ÐµÐºÑÑ‚Ð°/Ð°ÑƒÐ´Ð¸Ð¾ Ð±ÐµÐ· Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ `end_message`.
  2) Ð’Ñ‹Ð·Ð¾Ð² `InterruptSession(hardware_id)` â€” ÑÐµÑ€Ð²ÐµÑ€ Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ `global_interrupt_flag` Ð¸ Ð¿Ð¾Ð¼ÐµÑ‡Ð°ÐµÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÐµÑÑÐ¸Ð¸ ÐºÐ°Ðº `cancelled`, Ñ‡Ñ‚Ð¾ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸ÑŽ.
- Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹ (Ñ‚ÐµÐºÑÑ‚/Ð°ÑƒÐ´Ð¸Ð¾) Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ Ð¾Ð±Ð° ÑÐ¸Ð³Ð½Ð°Ð»Ð°: Ð³Ð»Ð¾Ð±Ñ„Ð»Ð°Ð³/ÑÑ‚Ð°Ñ‚ÑƒÑ ÑÐµÑÑÐ¸Ð¸ Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ñƒ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°.
- ÐŸÐ¾ÑÐ»Ðµ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ Ð½Ð¸ÐºÐ°ÐºÐ¸Ñ… Â«Ð¿Ð¾Ð·Ð´Ð½Ð¸Ñ…Â» Ñ‡Ð°Ð½ÐºÐ¾Ð² Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ Ð² Ð¿Ð¾Ñ‚Ð¾Ðº (Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¾Ð³Ð¾ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¸ UX bargeâ€‘in).

Ð¥Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ:
- ÐŸÑ€Ð¸ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ð¸ ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ð° â€” ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð² Ð‘Ð” (`database_manager.create_screenshot`) Ñ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸.

---

## 4) Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐºÑÑ‚Ð° (text_processor.py)

Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ Â«Ð¼Ð½Ð¾Ð³Ð¾ÑƒÑ€Ð¾Ð²Ð½ÐµÐ²Ñ‹Ð¹ Ñ„Ð¾Ð»Ð±ÑÐºÂ»:
- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹: Google Gemini Live API (ÐµÑÐ»Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½)
  - ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ð¾Ð¸ÑÐºÐ¾Ð²Ð¾Ð³Ð¾ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð° (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð»Ñ Â«Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð¹Â» Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸)
  - System prompt (role/Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð¾Ñ‚Ð²ÐµÑ‚Ð°) Ð·Ð°Ð´Ð°ÐµÑ‚ÑÑ Ð² ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ ÑÐµÑÑÐ¸Ð¸
- Fallback: LangChain + Gemini (ÐµÑÐ»Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾)
- Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑƒÐ¿Ñ€Ð¾Ñ‰Ñ‘Ð½Ð½Ñ‹Ð¹ Ñ„Ð¾Ð»Ð±ÑÐº: ÐµÑÐ»Ð¸ Ð½ÐµÑ‚ ÐºÐ»ÑŽÑ‡ÐµÐ¹/SDK â€” Ð¾Ñ‚Ð´Ð°Ñ‘Ñ‚ÑÑ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¹ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚-Ð·Ð°Ð³Ð»ÑƒÑˆÐºÐ°

ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸:
- ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¹ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ñ‚ÐµÐºÑÑ‚Ð° (streaming), Ð¾Ñ‚Ð´Ð°Ñ‘Ñ‚ Â«ÐºÑƒÑÐ¾Ñ‡ÐºÐ¸Â» Ñ‚ÐµÐºÑÑ‚Ð°
- Ð˜Ð¼ÐµÐµÑ‚ÑÑ Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð°Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð° Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ (`cancel_generation()`)
- Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð¿Ð°Ð¼ÑÑ‚ÑŒÑŽ/Ð‘Ð” (MemoryAnalyzer) â€” Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ Ð¿Ñ€Ð¸ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ð¸ ÐºÐ»ÑŽÑ‡ÐµÐ¹

---

## 5) Ð¡Ð¸Ð½Ñ‚ÐµÐ· Ð°ÑƒÐ´Ð¸Ð¾ (audio_generator.py)

Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ Â«Ð¼Ð½Ð¾Ð³Ð¾ÑƒÑ€Ð¾Ð²Ð½ÐµÐ²Ñ‹Ð¹ Ñ„Ð¾Ð»Ð±ÑÐºÂ»:
- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹: Azure Cognitive Services TTS
  - Ð’Ñ‹Ñ…Ð¾Ð´: 48000Hz, 16-bit, mono PCM
  - ÐšÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð°Ñ†Ð¸Ñ Ð² numpy Ð¼Ð°ÑÑÐ¸Ð² `int16`
- Fallback: Edge TTS (WebSocket) Ñ retry Ð¸ timeout
- Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ„Ð¾Ð»Ð±ÑÐº: ÑÐ¸Ð½ÑƒÑ/Â«Ð±Ð¸Ð¿Â» Ð´Ð»Ñ ÐºÑ€Ð°Ð¹Ð½ÐµÐ³Ð¾ ÑÐ»ÑƒÑ‡Ð°Ñ

ÐÐ° Ð²Ñ‹Ñ…Ð¾Ð´ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ `AudioChunk` Ñ `audio_data` (raw bytes), `dtype` (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ `int16`) Ð¸ `shape` (`[N]`).

---

## 6) Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ Ð¿Ð°Ð¼ÑÑ‚ÑŒ

- `database/database_manager.py` â€” Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð‘Ð” (SQLite Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ), CRUD ÑÐµÑÑÐ¸Ð¹ Ð¸ ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ð¾Ð²
- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ð°: Ð¿ÑƒÑ‚ÑŒ (Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹), URL (Ð¾Ð¿Ñ†.), Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ (base64_length, Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚, Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ ÑÐºÑ€Ð°Ð½Ð°)
- `TextProcessor.set_database_manager(...)` â€” Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð°Ð¼ÑÑ‚Ð¸/Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ð¿Ñ€Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸

---

## 7) ÐŸÑ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ñ (InterruptSession)

- RPC: `InterruptSession(InterruptRequest{hardware_id})` â†’ `InterruptResponse{success, interrupted_sessions, message}`
- ÐœÐµÑ…Ð°Ð½Ð¸ÐºÐ°:
  - Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ÑÑ `global_interrupt_flag` Ð¸ `interrupt_hardware_id`
  - Ð’ÑÐµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÐµÑÑÐ¸Ð¸ Ð¿Ð¾Ð¼ÐµÑ‡Ð°ÑŽÑ‚ÑÑ `cancelled=True`
  - Ð’ Ñ†Ð¸ÐºÐ»Ðµ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ‚ÐµÐºÑÑ‚Ð°/Ð°ÑƒÐ´Ð¸Ð¾ ÐµÑÑ‚ÑŒ Ñ‡Ð°ÑÑ‚Ñ‹Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ñ„Ð»Ð°Ð³Ð° Ð¸ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° ÑÐµÑÑÐ¸Ð¸
- ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð² `SLEEPING`

---

## 8) ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ (config.py, config.env)

- ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹: ÐºÐ»ÑŽÑ‡Ð¸ Gemini/ Azure Speech, Ð¿Ð¾Ñ€Ñ‚ gRPC/HTTP, Ð‘Ð”, Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Edge TTS
- `Config.validate()` Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ Ð¸Ð· `grpc_server` (Ð² __main__) Ð¸ Ð² main.py Ð¿Ð¾ Ð¼ÐµÑÑ‚Ñƒ
- Ð’ Ð¿Ñ€Ð¾Ð´Ðµ Ð²ÑÐµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°ÑŽÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· `config.env`/Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

---

## 9) Ð—Ð°Ð¿ÑƒÑÐº Ð¸ ÑÐµÑ€Ð²Ð¸ÑÑ‹ (main.py)

- HTTP (aiohttp) Ð½Ð° 8080: `/health`, `/`, `/status`
- gRPC Ð½Ð° `Config.GRPC_PORT` (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 50051)
- Update Server (Ð¾Ð¿Ñ†.) Ð½Ð° 8081: AppCast Ð¸ Ñ€Ð°Ð·Ð´Ð°Ñ‡Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹
- Ð’ÑÐµ ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÑŽÑ‚ÑÑ Ð¸Ð· `async def main()`; ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ð¾ Ctrl+C

---

## 10) ÐœÐ°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ð½Ð°Ð´ÐµÐ¶Ð½Ð¾ÑÑ‚ÑŒ

- ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¹ gRPC (`grpc.aio`) Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼Ð¸ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ (50MB)
- ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÑÐµÑÑÐ¸Ð¸: ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ‡ÐµÑ€ÐµÐ· `active_sessions` + Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹
- ÐŸÐ¾Ñ‚ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐºÐµÐ¹Ð»: Ð·Ð° ÑÑ‡Ñ‘Ñ‚ statelessâ€‘Ð»Ð¾Ð³Ð¸ÐºÐ¸; Ð³Ð»Ð¾Ð±Ñ„Ð»Ð°Ð³ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ñ Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÐµÑÑÐ¸Ð¸ Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½Ñ‹ Ðº Ð¸Ð½ÑÑ‚Ð°Ð½ÑÑƒ (Ð´Ð»Ñ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸â€‘Ð¸Ð½ÑÑ‚Ð°Ð½ÑÐ° Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ ÑÐ»Ð¾Ð¹: Redis/pubsub)
- Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐ½:
  - ÐŸÑ€Ð¾Ð¿Ð°Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ interrupt Ñ‡ÐµÑ€ÐµÐ· Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ ÑÑ‚Ð¾Ñ€ (Redis) Ð¿Ñ€Ð¸ k>1 Ð¸Ð½ÑÑ‚Ð°Ð½ÑÐµ
  - Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ð¾Ð²/Ð»Ð¾Ð³Ð¾Ð² Ð² object storage (S3/GCS) Ð²Ð¼ÐµÑÑ‚Ð¾ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ `/tmp`
  - ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ ÑÐµÑÑÐ¸Ð¸/Ñ‚Ð°Ð¹Ð¼â€‘Ð°ÑƒÑ‚Ñ‹ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ gRPC ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°

---

## 11) ÐÐ°Ð±Ð»ÑŽÐ´Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ Ð¸ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

- Ð•Ð´Ð¸Ð½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° logging.basicConfig Ð² grpc_server/main
- ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ðµ Ð»Ð¾Ð³Ð¸ Ð½Ð° ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… ÑÑ‚Ð°Ð¿Ð°Ñ…: Ð¿Ñ€Ð¸Ñ‘Ð¼ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°, Ð½Ð°Ñ‡Ð°Ð»Ð¾/Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ðµ ÑÑ‚Ñ€Ð¸Ð¼Ð°, Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ/TTÐ¡, Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ñ (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð¾Ñ‚Ð»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ clientâ€‘cancel vs serverâ€‘error)
- Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¸Ð½Ñ‚Ñ‹ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹ Ð² StreamAudio Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸ (Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ/Ð¿Ð¾Ð½Ð¸Ð·Ð¸Ñ‚ÑŒ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ)

---

## 12) Ð§ÐµÐºâ€‘Ð»Ð¸ÑÑ‚ Ð¸Ð½Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð²

- [ ] Ð›ÑŽÐ±Ð°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐºÑÑ‚Ð° Ð¾Ñ‚Ð¼ÐµÐ½ÑÐµÐ¼Ð° (cancel_generation + Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ñ„Ð»Ð°Ð³Ð¾Ð²)
- [ ] TTS Ð²ÑÐµÐ³Ð´Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚: 48 kHz, int16 mono (Ð¸Ð»Ð¸ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ÑÑ)
- [ ] ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ gRPC Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ÑÑ Ð½Ð° Ð¾Ñ‚Ð¼ÐµÐ½Ñƒ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ñ†Ð¸ÐºÐ»Ð¾Ð²
- [ ] Ð Ð°Ð·Ð¼ÐµÑ€Ñ‹ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ ÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ñ‹ Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð¼ (Ð´Ð¾ 50MB)
- [ ] ÐŸÑ€Ð¸ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ð¸ ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ÑÑ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð² Ð‘Ð” Ñ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸

â€” Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð»Ñ bargeâ€‘in ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° (pressâ€‘first):
- [ ] ÐŸÑ€Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° ÑÑ‚Ñ€Ð¸Ð¼ Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾ Ð¿Ñ€ÐµÐºÑ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ, Ð±ÐµÐ· Â«Ñ…Ð²Ð¾ÑÑ‚Ð¾Ð²Ñ‹Ñ…Â» Ð°ÑƒÐ´Ð¸Ð¾ Ñ‡Ð°Ð½ÐºÐ¾Ð²
- [ ] ÐÐµÑ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ `end_message` Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ðµ; Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð»Ð¾Ð³ Â«cancelled by clientÂ»

---

## 13) ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹

- gRPC ÑÐµÑ€Ð²Ð¸Ñ: `server/grpc_server.py`, `server/streaming.proto`
- Ð¢ÐµÐºÑÑ‚: `server/text_processor.py`
- ÐÑƒÐ´Ð¸Ð¾: `server/audio_generator.py`
- Ð‘Ð”: `server/database/database_manager.py`
- ÐšÐ¾Ð½Ñ„Ð¸Ð³: `server/config.py`, `server/config.env(.example)`
- Ð—Ð°Ð¿ÑƒÑÐº: `server/main.py`
- ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ: `server/update_server.py`, `server/updates/*`

Ð•ÑÐ»Ð¸ Ñ‡ÐµÐ³Ð¾â€‘Ñ‚Ð¾ Ð½Ðµ Ñ…Ð²Ð°Ñ‚Ð°ÐµÑ‚ â€” ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Issue/PR, ÑÑ‚Ð¾Ñ‚ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ ÑÐ²Ð»ÑÐµÑ‚ÑÑ Â«Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¾Ð¼ Ð¸ÑÑ‚Ð¸Ð½Ñ‹Â» Ð¿Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð½Ð¾Ð¹ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ðµ.

---

## 14) Ð”Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ (Mermaid)

ÐŸÐ¾Ñ‚Ð¾Ðº StreamAudio (ÑÐµÑ€Ð²ÐµÑ€Ð½Ñ‹Ð¹ ÑÑ‚Ñ€Ð¸Ð¼Ð¸Ð½Ð³)

```mermaid
sequenceDiagram
    participant Client
    participant GRPC as StreamingService (gRPC)
    participant TP as TextProcessor
    participant TTS as AudioGenerator
    participant DB as Database

    Client->>GRPC: StreamAudio(StreamRequest)
    GRPC->>TP: generate text (async)
    loop text chunks
        TP-->>GRPC: text_chunk
        GRPC->>TTS: synthesize(text_chunk)
        TTS-->>GRPC: AudioChunk(bytes,int16,[N])
        GRPC-->>Client: StreamResponse.audio_chunk
    end
    alt has screenshot
        GRPC->>DB: create_screenshot(session_id, meta)
    end
    GRPC-->>Client: StreamResponse.end_message
```

ÐŸÑ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ðµ ÑÐµÑÑÐ¸Ð¹ (Ð´Ð²Ð° Ð¿ÑƒÑ‚Ð¸)

```mermaid
sequenceDiagram
    participant Client
    participant GRPC as StreamingService
    participant TP as TextProcessor

    rect rgb(240,250,240)
    note over Client,GRPC: ÐŸÑƒÑ‚ÑŒ 1 (Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð´Ð»Ñ bargeâ€‘in)
    Client-xGRPC: cancel client stream (context cancelled)
    GRPC->>TP: cancel_generation()
    note right of GRPC: Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑŽÑ‚ context.cancelled()
    end

    rect rgb(250,240,240)
    note over Client,GRPC: ÐŸÑƒÑ‚ÑŒ 2 (RPC Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹)
    Client->>GRPC: InterruptSession(hardware_id)
    GRPC->>GRPC: set global_interrupt_flag + mark sessions cancelled
    GRPC->>TP: cancel_generation()
    GRPC-->>Client: InterruptResponse{success, interrupted_sessions}
    end
```

ÐžÐ±Ñ‰Ð¸Ð¹ Ð²Ð¸Ð´ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð² ÑÐµÑ€Ð²ÐµÑ€Ð°

```mermaid
flowchart LR
  subgraph Runtime
    A[HTTP Server :8080\n/health /status]
    B[gRPC Server :50051\nStreamingService]
    C[Update Server :8081\nAppCast/Downloads]
  end
  B --> TP[TextProcessor\nGemini Live / LangChain / Fallback]
  B --> TTS[AudioGenerator\nAzure / Edge TTS / Local]
  B --> DB[(Database)]
  Client[[Client App]] -->|gRPC| B
  Client -.->|HTTP (health)| A
```
